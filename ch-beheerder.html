<!DOCTYPE html>
<html lang="nl">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beheerder Dossier Management Systeem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Aangepaste stijlen voor de flow */
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        .progress-step { transition: color 0.3s, border-color 0.3s; }
        .progress-step.active { border-color: #10B981; color: #10B981; }
        .progress-step.active .step-dot { background-color: #10B981; }
        .step-dot { transition: background-color 0.3s; }
        /* AANPASSING 1: Hele rij is klikbaar */
        .list-row { transition: background-color 0.2s; cursor: pointer; } 
        .list-row:hover { background-color: #f0f4f8; }
        .status-badge { display: inline-flex; align-items: center; justify-content: center; padding: 0.25rem 0.65rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; }
        .status-badge-go { background-color: #D1FAE5; color: #059669; } /* Groen */
        .status-badge-nogo { background-color: #FEE2E2; color: #EF4444; } /* Rood */
        .status-badge-cond { background-color: #FEF3C7; color: #D97706; } /* Oranje/Geel */
        .status-badge-default { background-color: #E5E7EB; color: #4B5563; } /* Grijs */
        /* Stijl voor de actieknop */
        .detail-action-button { cursor: pointer; padding: 0.5rem; border-radius: 9999px; transition: background-color 0.15s; }
        .detail-action-button:hover { background-color: #E5E7EB; }
        .criteria-row { cursor: pointer; transition: background-color 0.15s; }
        .criteria-row:hover { background-color: #F3F4F6; }
        
        /* Nieuwe stijlen voor de detail-views */
        .dossier-module-view { min-height: 600px; }
        .nav-button-module { transition: transform 0.1s, box-shadow 0.1s; }
        .nav-button-module:active { transform: translateY(1px); box-shadow: none; }
        
        /* Styling for the mini map */
        .mini-map-placeholder {
            background-image: url('https://placehold.co/400x250/F1F5F9/1D4ED8?text=Plankcontour');
            background-size: cover;
            background-position: center;
            border-radius: 0.5rem;
            height: 250px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

    </style>
</head>
<body class="p-4 md:p-8">

    <!-- Hoofd Navigatie / Rol -->
    <header class="mb-6 flex justify-between items-center pb-4 border-b border-gray-200">
        <h1 class="text-2xl font-bold text-gray-800">Dossier Beheer</h1>
        <div class="flex items-center space-x-3">
            <span class="text-sm text-gray-500">Ingelogd als:</span>
            <span class="px-3 py-1 bg-blue-500 text-white text-sm font-semibold rounded-full shadow-md">Beheerder</span>
        </div>
    </header>

    <!-- Main Container -->
    <main class="max-w-7xl mx-auto">
        <!-- Overzicht Dossiers View (Dashboard) -->
        <div id="dashboard-view" class="view">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                <h2 class="text-xl font-semibold text-gray-700 mb-4 md:mb-0">Alle Dossiers (36)</h2>
                <div class="flex flex-wrap gap-3">
                    <!-- Filters -->
                    <select id="filter-regio" class="px-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                        <option value="">Regio (Alle)</option>
                        <option>Antwerpen</option>
                        <option>Limburg</option>
                    </select>
                    <select id="filter-status" class="px-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                        <option value="">Status (Alle)</option>
                        <option>Aanvraag</option>
                        <option>Check door provincie</option>
                        <option>In gesprek</option>
                        <option>Beslist</option>
                        <option>Gematcht</option>
                    </select>
                    <select id="filter-type" class="px-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                        <option value="">Vraag / Aanbod</option>
                        <option>Vraag (Definitief)</option>
                        <option>Aanbod (Preadvies)</option>
                    </select>

                    <!-- Weergave Toggle -->
                    <div class="inline-flex rounded-lg shadow-sm border border-gray-300">
                        <button id="toggle-list" class="px-4 py-2 text-sm font-medium rounded-l-lg bg-white text-gray-700 hover:bg-gray-50 transition-colors">
                            Lijst
                        </button>
                        <button id="toggle-gis" class="px-4 py-2 text-sm font-medium rounded-r-lg bg-gray-100 text-gray-500 hover:bg-gray-200 transition-colors">
                            GIS-weergave
                        </button>
                    </div>
                </div>
            </div>

            <!-- Dossier List (Lijstweergave) -->
            <div id="dossier-list-container" class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Naam</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell">Adres</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell">Opp</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell">Type</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell">Update</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Acties</th>
                        </tr>
                    </thead>
                    <tbody id="dossier-list-body" class="divide-y divide-gray-200">
                        <!-- Dossier Rows will be inserted here by JS -->
                    </tbody>
                </table>
                <div id="empty-list-msg" class="text-center p-6 text-gray-500 hidden">Geen dossiers gevonden met de geselecteerde filters.</div>
            </div>

            <!-- GIS Dossier View (Map Weergave) -->
            <div id="dossier-gis-container" class="bg-white rounded-xl shadow-lg p-4 h-[600px] border border-gray-200 hidden">
                <div class="h-full w-full bg-gray-200 flex items-center justify-center text-gray-500 text-xl font-medium relative rounded-lg">
                    <!-- GIS Legenda: Kleurcode naar Vraag/Aanbod en Preadvies/Definitief -->
                    <div class="absolute top-4 left-4 bg-white p-3 rounded-lg shadow-md text-sm font-semibold border border-gray-200">
                        <h3 class="font-bold mb-1 border-b pb-1 text-gray-700">Kleurcode Dossiers</h3>
                        <p class="mb-1"><span class="p-1 inline-block w-4 h-4 bg-green-500 rounded-full align-middle mr-2"></span> **Vraag** (Definitief)</p>
                        <p class="mb-1"><span class="p-1 inline-block w-4 h-4 bg-green-200 rounded-full align-middle mr-2"></span> **Vraag** (Preadvies)</p>
                        <p class="mb-1"><span class="p-1 inline-block w-4 h-4 bg-blue-500 rounded-full align-middle mr-2"></span> **Aanbod** (Definitief)</p>
                        <p><span class="p-1 inline-block w-4 h-4 bg-blue-200 rounded-full align-middle mr-2"></span> **Aanbod** (Preadvies)</p>
                    </div>

                    <!-- GIS Kaart Interactie Placeholder -->
                    <p>GIS-kaartweergave van alle plankcontouren (Placeholder)</p>

                    <!-- Compacte samenvatting bij Hover/Klik -->
                    <div id="gis-hover-info" class="absolute bottom-4 left-4 bg-white p-4 rounded-lg shadow-xl text-sm w-64 hidden border border-gray-300">
                         <p class="font-bold text-gray-800">Dossier: Konijnenberg</p>
                         <p class="text-gray-600 text-xs">Type: Vraag (Definitief) | Status: Check Provincie</p>
                         <!-- De doorklik naar detail is een button in de hover box -->
                         <p class="text-blue-600 mt-2 cursor-pointer font-medium" onclick="goToDetail(1)">Bekijk Detail &gt;</p>
                    </div>

                    <p class="absolute bottom-4 right-4 text-sm text-center italic text-gray-400">Interactie: Hover/klik toont compacte samenvatting.</p>
                </div>
            </div>
        </div>

        <!-- Detail Dossier View - Nieuwe centrale structuur -->
        <div id="detail-view" class="view hidden">
            <!-- Navigatie & Header -->
            <div class="flex justify-between items-center mb-6 pb-4 border-b border-gray-200">
                <button onclick="goBackToDashboard()" class="text-blue-600 hover:text-blue-800 text-sm font-medium flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="m15 18-6-6 6-6"/></svg>
                    Terug naar Overzicht Dossiers
                </button>
                <div class="flex items-center space-x-3">
                    <h2 id="dossier-detail-title" class="text-2xl font-bold text-gray-800">Konijnenberg</h2>
                    <span id="dossier-status-badge" class="status-badge status-badge-cond text-lg font-semibold shadow-md">Check door provincie</span>
                </div>
                <button onclick="setDetailTab('gis-visualisation')" class="px-3 py-1 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-300 transition-colors flex items-center shadow-sm">
                     <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21 3 6"/></svg>
                    Toon Kaart
                </button>
            </div>


            <!-- Hoofdnavigatie op Detailniveau (Informatie / Criteria / Matches) -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <!-- Navigatie Knoppen -->
                <button onclick="setDetailTab('info')" id="nav-info" class="nav-button-module p-6 text-center rounded-xl border-2 border-blue-500 transition-colors shadow-lg bg-white">
                    <h3 class="font-bold text-xl text-blue-600">Informatie (Info)</h3>
                    <p class="text-sm text-gray-500 mt-1">Basisgegevens & Context</p>
                </button>
                <button onclick="setDetailTab('criteria')" id="nav-criteria" class="nav-button-module p-6 text-center rounded-xl border-2 hover:border-blue-500 transition-colors shadow-lg bg-white">
                    <h3 class="font-bold text-xl text-blue-600">Criteria-analyse (4a)</h3>
                    <p class="text-sm text-gray-500 mt-1">Beoordeling & Beslissing</p>
                </button>
                <button onclick="setDetailTab('match')" id="nav-match" class="nav-button-module p-6 text-center rounded-xl border-2 hover:border-blue-500 transition-colors shadow-lg bg-white">
                    <h3 class="font-bold text-xl text-blue-600">Match-beheer (4b)</h3>
                    <p class="text-sm text-gray-500 mt-1">Lijsten, GIS & Rapportage</p>
                </button>
            </div>


            <!-- MODULES (dossier-module-view vervangt de detail-tabs) -->
            <div class="dossier-module-view bg-white rounded-xl shadow-lg p-6 border border-gray-200">
                
                <!-- MODULE: Dossier Informatie (Info) -->
                <div id="module-info" class="active-module">
                    <h3 class="font-semibold text-xl border-b pb-2 mb-4 text-gray-800">Basis Dossiergegevens</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Kolom 1: Data -->
                        <div class="space-y-4">
                            <h4 class="font-semibold text-lg mb-2 border-b pb-1 text-gray-700">Algemene Gegevens</h4>
                            <p class="text-gray-600"><span class="font-semibold text-gray-800 w-32 inline-block">Status:</span> Check door provincie</p>
                            <p class="text-gray-600"><span class="font-semibold text-gray-800 w-32 inline-block">Gemeente:</span> Antwerpen</p>
                            <p class="text-gray-600"><span class="font-semibold text-gray-800 w-32 inline-block">Oppervlakte:</span> 6,09 ha</p>
                            <p class="text-gray-600"><span class="font-semibold text-gray-800 w-32 inline-block">Type:</span> Vraag (Definitief)</p>
                            <p class="text-gray-600"><span class="font-semibold text-gray-800 w-32 inline-block">Risicofactor:</span> Tijdsdruk (Hoog)</p>
                            
                             <h4 class="font-semibold text-lg mb-2 border-b pt-4 pb-1 text-gray-700">Bestemming & Contact</h4>
                            <p class="text-sm text-gray-600"><span class="font-semibold text-gray-800 w-32 inline-block">Huidig:</span> Wonen / Agrarisch</p>
                            <p class="text-sm text-gray-600"><span class="font-semibold text-gray-800 w-32 inline-block">Nieuw:</span> KMO-zone / Lichte industrie</p>
                            <div class="mt-4 pt-3 border-t border-gray-200">
                                <p class="text-sm text-gray-600"><span class="font-semibold text-gray-800 w-32 inline-block">Contact:</span> Jan Peeters</p>
                                <p class="text-xs text-blue-500 pl-32">jan.peeters@voorbeeld.be</p>
                            </div>
                        </div>

                        <!-- Kolom 2: Mini GIS Visualisatie -->
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 flex flex-col justify-between">
                            <div>
                                
                            </div>
                            
                            <button onclick="setDetailTab('gis-visualisation')" class="mt-4 bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold shadow-md hover:bg-gray-300 transition-colors flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                                Vergroot Kaart / Volledige GIS-Visualisatie
                            </button>
                        </div>
                    </div>
                    <div class="mt-8 pt-4 border-t border-gray-200">
                         <button onclick="setDetailTab('criteria')" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold shadow-md hover:bg-blue-700 transition-colors">
                            Ga naar Criteria-analyse
                        </button>
                    </div>
                </div>

                <!-- MODULE: Criteria-analyse OVERZICHT (Stap 4a - Eerste Scherm) -->
                <div id="module-criteria" class="hidden active-module">
                    <h3 class="text-xl font-semibold mb-4 border-b pb-2">Criteria-check Overzicht</h3>

                    <!-- Tabel Huidige Bestemming -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-3 text-gray-700">Huidige Bestemming (Wonen / Agrarisch)</h4>
                        <div class="bg-white rounded-lg overflow-hidden border border-gray-200">
                            <div class="grid grid-cols-12 p-3 font-bold text-xs uppercase text-gray-600 border-b border-gray-200 bg-gray-50">
                                <div class="col-span-4">Kaartlaag</div>
                                <div class="col-span-8">Resultaat</div>
                            </div>
                            <!-- Rij 1: NO GO (Klikbaar) -->
                            <div class="grid grid-cols-12 p-3 text-sm criteria-row border-b border-red-200" onclick="goToCriteriaDetail('K1', 'Huidig')">
                                <div class="col-span-4 font-medium text-red-700">K1: Rood Omrand Gebied</div>
                                <div class="col-span-8 flex items-center">
                                    <span id="overview-k1-status" class="status-badge status-badge-nogo mr-4">NO GO</span>
                                    <span class="text-gray-600 text-xs">Afstand tot kern: 100m</span>
                                </div>
                            </div>
                             <!-- Rij 2: VOORWAARDE (Klikbaar) -->
                            <div class="grid grid-cols-12 p-3 text-sm criteria-row border-b border-yellow-200" onclick="goToCriteriaDetail('K2', 'Huidig')">
                                <div class="col-span-4 font-medium text-yellow-700">K2: Waterkering</div>
                                <div class="col-span-8 flex items-center">
                                    <span class="status-badge status-badge-cond mr-4">VOORWAARDEN</span>
                                    <span class="text-gray-600 text-xs">Bufferzone 50m vereist.</span>
                                </div>
                            </div>
                            <!-- Rij 3: GO (Klikbaar) -->
                            <div class="grid grid-cols-12 p-3 text-sm criteria-row border-b border-green-200" onclick="goToCriteriaDetail('K3', 'Huidig')">
                                <div class="col-span-4 font-medium text-green-700">K3: Erfgoed (Archeo)</div>
                                <div class="col-span-8 flex items-center">
                                    <span class="status-badge status-badge-go mr-4">GO</span>
                                    <span class="text-gray-600 text-xs">Buiten verwachtingszone.</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabel Nieuwe Bestemming -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold mb-3 text-gray-700">Nieuwe Bestemming (KMO-zone / Lichte industrie)</h4>
                        <div class="bg-white rounded-lg overflow-hidden border border-gray-200">
                            <div class="grid grid-cols-12 p-3 font-bold text-xs uppercase text-gray-600 border-b border-gray-200 bg-gray-50">
                                <div class="col-span-4">Kaartlaag</div>
                                <div class="col-span-8">Resultaat</div>
                            </div>
                            <!-- Rij 4: GO (Klikbaar) -->
                            <div class="grid grid-cols-12 p-3 text-sm criteria-row border-b border-green-200" onclick="goToCriteriaDetail('K4', 'Nieuw')">
                                <div class="col-span-4 font-medium text-green-700">K4: Industriezones (Lokaal)</div>
                                <div class="col-span-8 flex items-center">
                                    <span class="status-badge status-badge-go mr-4">GO</span>
                                    <span class="text-gray-600 text-xs">Voldoet aan KMO-profiel.</span>
                                </div>
                            </div>
                            <!-- Rij 5: VOORWAARDE (Klikbaar) -->
                            <div class="grid grid-cols-12 p-3 text-sm criteria-row border-b border-yellow-200" onclick="goToCriteriaDetail('K5', 'Nieuw')">
                                <div class="col-span-4 font-medium text-yellow-700">K5: Mobiliteit (Vrachtverkeer)</div>
                                <div class="col-span-8 flex items-center">
                                    <span class="status-badge status-badge-cond mr-4">VOORWAARDEN</span>
                                    <span class="text-gray-600 text-xs">Toegangsweg moet aangepast worden.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8 pt-4 border-t border-gray-200">
                         <p class="font-semibold text-gray-700">Volgende stap: Beslissing</p>
                         <button onclick="goToCriteriaDetail('BESLISSING', 'Algemeen')" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold shadow-md hover:bg-blue-700 transition-colors mt-3">
                            Neem de Beoordelingsbeslissing
                        </button>
                    </div>
                </div>

                <!-- MODULE: Criteria-analyse DETAIL (Sub-scherm voor aanpassing/beslissing) -->
                <div id="module-criteria-detail" class="hidden active-module">
                    <button onclick="setDetailTab('criteria')" class="text-blue-600 hover:text-blue-800 text-sm font-medium mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="m15 18-6-6 6-6"/></svg>
                        Terug naar Overzicht Criteria
                    </button>
                    
                    <h3 class="text-xl font-semibold mb-2">Analyse Detail: <span id="current-criteria-name" class="text-blue-600">K1: Rood Omrand Gebied</span></h3>
                    <p class="text-sm text-gray-600 mb-6">Bestemming: <span id="current-criteria-dest">Huidig (Wonen / Agrarisch)</span></p>

                    <div class="flex flex-col lg:flex-row gap-6">
                        <!-- Linkerpaneel: Context en Beslissing -->
                        <div class="lg:w-1/2">
                            <div class="p-4 border border-gray-200 rounded-lg bg-gray-50 mb-6">
                                <h4 class="font-bold mb-2">Context & Resultaat</h4>
                                <p class="text-sm mb-2"><span class="font-semibold">Context:</span> <span id="current-criteria-context">Afstand tot kern: 100m.</span></p>
                                <p class="text-sm"><span class="font-semibold">Resultaat:</span> <span id="current-criteria-result" class="status-badge status-badge-nogo">NO GO</span></p>
                            </div>

                            <div id="override-section" class="mb-8 p-4 border-2 border-red-300 rounded-lg bg-red-50 hidden">
                                <h4 class="text-lg font-bold text-red-700 mb-3">No-Go Aanpassing & Fiattering</h4>
                                <p class="text-sm text-gray-700 mb-3">U kunt de 'No Go' aanpassen met motivering. Dit vereist fiattering door het teamhoofd gemeentelijk steunpunt.</p>
                                <button onclick="showOverrideModal('K1')" class="bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-semibold shadow-md hover:bg-red-700 transition-colors">
                                    No-Go Aanpassen / Motiveren
                                </button>
                                <p id="k1-override-status-display" class="mt-3 text-sm text-green-600 font-medium hidden">
                                    Status: AANGEPAST (GO) - Goedgekeurd door Teamhoofd.
                                </p>
                            </div>
                            
                            <h3 id="decision-title" class="text-xl font-semibold mb-4 border-t pt-4">Beoordelingsbeslissing</h3>
                            <p class="text-sm text-gray-600 mb-4">Met deze actie wordt de beoordeling vastgelegd en het matchingproces gestart/gecontinueerd.</p>

                            <div class="flex flex-col space-y-3">
                                <button id="decision-go" onclick="setDecision('GO')" class="bg-green-600 text-white px-6 py-3 rounded-lg font-semibold shadow-md hover:bg-green-700 transition-colors">
                                    Beslissing: GO (Start Matching)
                                </button>
                                <button id="decision-cond" onclick="setDecision('VOORWAARDEN')" class="bg-yellow-600 text-white px-6 py-3 rounded-lg font-semibold shadow-md hover:bg-yellow-700 transition-colors">
                                    Beslissing: Voorwaarden (Continue Matching)
                                </button>
                                <button id="decision-nogo" onclick="setDecision('NO GO')" class="bg-red-600 text-white px-6 py-3 rounded-lg font-semibold shadow-md hover:bg-red-700 transition-colors">
                                    Beslissing: NO GO (Stop Matching)
                                </button>
                            </div>
                            <p id="decision-message" class="mt-4 text-center font-medium text-gray-700 hidden">
                                Huidige Beslissing: <span class="text-green-600">GO</span>. Het matchingproces is gestart.
                            </p>
                        </div>

                        <!-- Rechterpaneel: GIS Visualisatie van de Plancontour (Mini-GIS) -->
                        <div class="lg:w-1/2">
                            <div class="bg-gray-100 p-4 rounded-xl h-[450px] border border-gray-300 relative">
                                <h4 class="font-bold text-gray-700 mb-2">GIS-Visualisatie Plancontour (<span id="gis-criteria-layer">K1</span>)</h4>
                                <div id="mini-gis-map" class="h-full bg-cover bg-center rounded-lg shadow-inner" style="background-image: url('https://placehold.co/600x400/D1D5DB/4B5563?text=Kaartlaag+Weergave+(K1+actief)')">
                                    <!-- GIS UI à la Geopunt: Lagenlijst -->
                                    <div class="absolute top-3 right-3 bg-white p-3 rounded-lg shadow-xl w-40 border border-gray-200">
                                        <p class="font-semibold text-sm mb-2 border-b pb-1">Kaartlagen</p>
                                        <label class="flex items-center text-xs mb-1"><input type="checkbox" checked class="mr-2 accent-blue-500"> Plankcontour</label>
                                        <label class="flex items-center text-xs mb-1"><input type="checkbox" checked class="mr-2 accent-red-500" id="gis-layer-k1"> K1 Rood Omrand</label>
                                        <label class="flex items-center text-xs mb-1"><input type="checkbox" class="mr-2 accent-yellow-500" id="gis-layer-k3"> K3 Erfgoed</label>
                                        <label class="flex items-center text-xs mb-1"><input type="checkbox" class="mr-2 accent-green-500"> GRP</label>
                                        <p class="text-xs mt-2 text-blue-600 cursor-pointer border-t pt-1">Pas transparantie aan</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MODULE: Match-beheer (Stap 4b) -->
                <div id="module-match" class="hidden active-module">
                     <h3 class="text-xl font-semibold mb-4 border-b pb-2">Match-beheer</h3>
                    <p class="text-gray-600 mb-6">Overzicht van potentiële matches. Exporteer de lijst voor verdere analyse, of bekijk de GIS-visualisatie om de ruimtelijke impact te zien.</p>

                    <div class="flex justify-between items-center mb-4 p-3 bg-gray-100 rounded-lg border border-gray-200">
                        <span class="font-medium text-lg">Huidige Matches (4)</span>
                        <div class="space-x-3 flex">
                            <button class="px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors flex items-center border border-gray-300 shadow-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                                Export (Excel)
                            </button>
                            <button onclick="setDetailTab('match-gis')" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors flex items-center shadow-md">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21 3 6"/></svg>
                                GIS-Visualisatie
                            </button>
                        </div>
                    </div>

                    <!-- Matchlijst (Vereenvoudigd) -->
                    <div class="bg-white rounded-lg divide-y divide-gray-200 border">
                        <div class="flex justify-between items-center p-4 bg-gray-50 text-xs uppercase font-semibold text-gray-600">
                            <div class="w-1/4">Naam Match</div>
                            <div class="w-1/4">Gemeente</div>
                            <div class="w-1/4">Status</div>
                            <div class="w-1/4 text-right">Oppervlakte</div>
                        </div>
                        <div class="p-4 flex justify-between items-center hover:bg-gray-50 transition-colors">
                            <div class="font-medium w-1/4">De Wilde Zwaan</div>
                            <div class="text-sm w-1/4 text-gray-600">Mechelen</div>
                            <div class="text-sm w-1/4"><span class="status-badge status-badge-go">In onderhandeling</span></div>
                            <div class="text-sm w-1/4 text-right">8,5 ha</div>
                        </div>
                        <div class="p-4 flex justify-between items-center hover:bg-gray-50 transition-colors">
                            <div class="font-medium w-1/4">Grote Weide</div>
                            <div class="text-sm w-1/4 text-gray-600">Puurs</div>
                            <div class="text-sm w-1/4">
                                <span class="status-badge status-badge-nogo">In Procedure (Gelockt)</span>
                            </div>
                            <div class="text-sm w-1/4 text-right">2,1 ha</div>
                        </div>
                        <div class="p-4 flex justify-between items-center hover:bg-gray-50 transition-colors">
                            <div class="font-medium w-1/4">Project X</div>
                            <div class="text-sm w-1/4 text-gray-600">Boom</div>
                            <div class="text-sm w-1/4"><span class="status-badge status-badge-default">Nog geen initiatief</span></div>
                            <div class="text-sm w-1/4 text-right">4,0 ha</div>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-3">* Matches in procedure worden gelockt/rood gemarkeerd voor andere kandidaten (volgens statusmodel).</p>
                    
                    <div class="mt-8 pt-4 border-t border-gray-200">
                         <button onclick="setDetailTab('report')" class="bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold shadow-md hover:bg-purple-700 transition-colors">
                            Ga naar Rapportering
                        </button>
                    </div>
                </div>

                <!-- MODULE: Rapportering -->
                <div id="module-report" class="hidden active-module">
                     <h3 class="text-xl font-semibold mb-4 border-b pb-2">Rapportering</h3>
                    <div class="p-6 border border-gray-200 rounded-lg bg-gray-50">
                        <h4 class="font-bold text-lg mb-4 text-gray-800">Definitief Rapport aan Gemeente</h4>
                        <p class="text-sm text-gray-700 mb-4">De definitieve beslissing is vastgelegd als: <span class="font-extrabold text-green-700">GO</span></p>

                        <!-- Voorwaarden -->
                        <div class="mb-4 p-3 bg-white rounded-lg border border-yellow-300">
                            <h5 class="font-semibold text-base mb-2 text-yellow-700">Opgelegde Voorwaarden</h5>
                            <ul class="list-disc list-inside text-sm text-gray-600 pl-4">
                                <li>Archeologisch onderzoek is vereist conform K3-criteria.</li>
                                <li>Bufferzone van 50m met aangrenzende woonzone moet landschappelijk worden ingepast.</li>
                            </ul>
                        </div>

                        <!-- Disclaimers -->
                        <div class="mb-4 p-3 bg-white rounded-lg border border-gray-300">
                            <h5 class="font-semibold text-base mb-2 text-gray-700">Disclaimers</h5>
                            <p class="text-sm text-gray-600">Dit advies is gebaseerd op de door u aangeleverde gegevens en de huidige stand van de GIS-kaartlagen. Het vervangt geen definitieve besluitvorming. Verklaring op eer over conformiteit met GRS/beleidsplan kon niet automatisch worden geverifieerd (zie Businesslogica).</p>
                        </div>

                        <!-- Omzetbrieven -->
                        <div class="mb-4 p-3 bg-white rounded-lg border border-gray-300">
                            <h5 class="font-semibold text-base mb-2 text-gray-700">Verwijzingen Omzetbrieven</h5>
                            <p class="text-sm text-gray-600">Verwijzing naar omzetbrief dd. 10/01/2026, sectie 4.2.</p>
                        </div>

                        <button class="mt-4 bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold shadow-md hover:bg-purple-700 transition-colors">
                            Genereer & Verzend Rapport
                        </button>
                    </div>
                </div>

                 <!-- MODULE: Match-beheer (GIS) -->
                <div id="module-match-gis" class="hidden active-module">
                    <button onclick="setDetailTab('match')" class="text-blue-600 hover:text-blue-800 text-sm font-medium mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="m15 18-6-6 6-6"/></svg>
                        Terug naar Matchlijst
                    </button>

                    <div class="bg-gray-100 p-4 rounded-xl h-[500px] border border-gray-300 relative">
                        <div class="h-full w-full bg-cover bg-center rounded-lg shadow-inner flex items-center justify-center text-gray-500 text-xl font-medium" style="background-image: url('https://placehold.co/600x500/D1D5DB/4B5563?text=GIS-Visualisatie+van+Matches')">
                            <div class="absolute top-4 left-4 bg-white p-2 rounded-lg shadow-md text-sm font-semibold border border-gray-200">
                                <h3 class="font-bold mb-1">Legenda Matches</h3>
                                <p class="mb-1"><span class="p-1 inline-block w-4 h-4 bg-blue-600 rounded-full align-middle mr-2"></span> Aangevraagd Dossier</p>
                                <p class="mb-1"><span class="p-1 inline-block w-4 h-4 bg-green-500 rounded-full align-middle mr-2"></span> Match: In Onderhandeling</p>
                                <p><span class="p-1 inline-block w-4 h-4 bg-red-500 rounded-full align-middle mr-2"></span> Match: In Procedure (Gelockt)</p>
                            </div>
                            <p class="absolute bottom-4 text-sm text-center italic">Overzicht van alle matches, met de optie om individuele matches te selecteren.</p>
                        </div>
                    </div>
                </div>

                 <!-- MODULE: GIS Visualisatie van het dossier (Grote Kaart) -->
                <div id="module-gis-visualisation" class="hidden active-module">
                    <!-- De navigatie is hier dynamisch: ofwel terug naar de Info tab, ofwel terug naar de Criteria tab -->
                    <button onclick="goBackFromGis()" id="back-from-gis" class="text-blue-600 hover:text-blue-800 text-sm font-medium mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="m15 18-6-6 6-6"/></svg>
                        Terug
                    </button>

                    <h3 class="text-xl font-semibold mb-4 border-b pb-2">Dossier Visualisatie (Grote Kaart)</h3>

                    <div class="bg-gray-100 p-4 rounded-xl h-[650px] border border-gray-300 relative">
                        <div class="h-full w-full bg-cover bg-center rounded-lg shadow-inner flex items-center justify-center text-gray-500 text-xl font-medium" style="background-image: url('https://placehold.co/800x650/F1F5F9/1D4ED8?text=Grote+GIS-Kaart+Dossier+Contour')">
                            <div class="absolute top-4 right-4 bg-white p-3 rounded-lg shadow-xl w-40 border border-gray-200">
                                <p class="font-semibold text-sm mb-2 border-b pb-1">Kaartlagen</p>
                                <label class="flex items-center text-xs mb-1"><input type="checkbox" checked class="mr-2 accent-blue-500"> Plankcontour</label>
                                <label class="flex items-center text-xs mb-1"><input type="checkbox" checked class="mr-2 accent-red-500"> Gewestplan</label>
                                <label class="flex items-center text-xs mb-1"><input type="checkbox" class="mr-2 accent-yellow-500"> Luchtfoto</label>
                                <p class="text-xs mt-2 text-blue-600 cursor-pointer border-t pt-1">Transparantie / Meten</p>
                            </div>
                            <p>GIS-Visualisatie met Plankcontour</p>
                        </div>
                    </div>
                </div>
                
            </div>
            
        </div>
    </main>

    <!-- Modal for NO GO Override -->
    <div id="override-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4" onclick="if(event.target.id === 'override-modal') hideOverrideModal()">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-lg">
            <h3 class="text-xl font-bold mb-4">No Go Aanpassing: <span id="override-criteria-title">K1</span></h3>
            <p class="text-sm text-gray-600 mb-4">Als beheerder kunt u de 'No Go' aanpassen met een dwingende motivering, wat fiattering door het teamhoofd vereist.</p>

            <div class="mb-4">
                <label for="override-motivation" class="block text-sm font-medium text-gray-700 mb-1">Motivering aanpassing</label>
                <textarea id="override-motivation" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Voer hier de gedetailleerde en dwingende motivering in (minimaal 20 tekens)..."></textarea>
            </div>

            <div class="flex justify-between items-center">
                <button id="request-approval-btn" onclick="requestTeamHeadApproval()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md hover:bg-blue-700 transition-colors">
                    Verzoek Fiattering Teamhoofd
                </button>
                <button onclick="hideOverrideModal()" class="text-gray-600 hover:text-gray-900 px-4 py-2 rounded-lg transition-colors">Annuleren</button>
            </div>

            <p id="approval-status" class="mt-4 text-sm text-green-600 font-medium hidden">
                Motivering ingediend. Wacht op fiattering door Teamhoofd.
            </p>
        </div>
    </div>

    <script>
        const VIEWS = {
            DASHBOARD: 'dashboard',
            DETAIL: 'detail',
        };
        
        // Define mock data for criteria details
        const CRITERIA_DATA = {
            'K1': { name: 'K1: Rood Omrand Gebied', context: 'Afstand tot kern: 100m. Conflict met Rood Omrand Gebied vanwege nabijheid.', result: 'NO GO', dest_huidig: 'Huidig (Wonen / Agrarisch)', dest_nieuw: null, color: 'red' },
            'K2': { name: 'K2: Waterkering', context: 'Bufferzone van 50m met waterkering is vereist.', result: 'VOORWAARDEN', dest_huidig: 'Huidig (Wonen / Agrarisch)', dest_nieuw: null, color: 'yellow' },
            'K3': { name: 'K3: Erfgoed (Archeo)', context: 'Buiten verwachtingszone voor archeologische vondsten.', result: 'GO', dest_huidig: 'Huidig (Wonen / Agrarisch)', dest_nieuw: null, color: 'green' },
            'K4': { name: 'K4: Industriezones (Lokaal)', context: 'Voldoet aan KMO-profiel en heeft goede ontsluiting.', result: 'GO', dest_huidig: null, dest_nieuw: 'Nieuw (KMO-zone / Lichte industrie)', color: 'green' },
            'K5': { name: 'K5: Mobiliteit (Vrachtverkeer)', context: 'Toegangsweg is te smal. Aanpassing van de toegangsweg vereist.', result: 'VOORWAARDEN', dest_huidig: null, dest_nieuw: 'Nieuw (KMO-zone / Lichte industrie)', color: 'yellow' },
            // Algemeen is voor het beslissingsscherm, heeft geen kaartlaag
            'BESLISSING': { name: 'Algemene Beoordeling', context: '', result: '', dest_huidig: null, dest_nieuw: null, color: 'default' }
        };

        const initialDossiers = [
            { id: 1, name: "Konijnenberg", address: "Straatnaam 110, 20...", opp: "6,09 ha", type: "Vraag (Definitief)", update: "12/12/2025", status: "Check door provincie", matches: 4 },
            { id: 2, name: "De Cauwel", address: "Straatnaam 110, 20...", opp: "24,4 ha", type: "Aanbod (Preadvies)", update: "12/12/2025", status: "In gesprek", matches: 0, suggestion: "Suggestie" },
            { id: 3, name: "Prinsdom", address: "Straatnaam 110, 20...", opp: "4,1 ha", type: "Vraag (Definitief)", update: "12/12/2025", status: "Beslist (GO)", matches: 5 },
            { id: 4, name: "Burenbult", address: "Straatnaam 110, 20...", opp: "11,03 ha", type: "Aanbod (Definitief)", update: "12/12/2025", status: "Beslist (VOORWAARDEN)", matches: 2 },
            { id: 5, name: "Travers", address: "Straatnaam 110, 20...", opp: "24,4 ha", type: "Vraag (Preadvies)", update: "12/12/2025", status: "Aanvraag", matches: 0 },
            { id: 6, name: "Polspotten", address: "Straatnaam 110, 20...", opp: "4,1 ha", type: "Aanbod (Definitief)", update: "12/12/2025", status: "Beslist (NO GO)", matches: 0 },
        ];

        let currentView = VIEWS.DASHBOARD;
        let selectedDossierId = 1; 
        let activeModule = 'info'; // Standaard start op de Info fiche
        let currentCriteria = 'K1'; // Voor het detail scherm in de Criteria module
        let previousModule = 'info'; // Houdt de vorige module bij voor de terugknop in GIS

        // Variabele om de status van de NO GO override bij te houden (simulatie)
        let k1OverrideStatus = localStorage.getItem('k1_override_status') || 'NO GO'; // NO GO, PENDING, APPROVED

        // --- Core View Management ---

        function renderView() {
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('detail-view').classList.add('hidden');

            if (currentView === VIEWS.DASHBOARD) {
                document.getElementById('dashboard-view').classList.remove('hidden');
                const isGISToggled = document.getElementById('toggle-gis').classList.contains('bg-white');
                renderDossierList(isGISToggled);
            } else if (currentView === VIEWS.DETAIL) {
                document.getElementById('detail-view').classList.remove('hidden');
                renderDetailView();
            }
        }

        function renderDetailView() {
            const dossier = initialDossiers.find(d => d.id === selectedDossierId);
            if (!dossier) return;

            // 1. Update Header
            document.getElementById('dossier-detail-title').textContent = dossier.name;
            const statusBadge = document.getElementById('dossier-status-badge');
            statusBadge.textContent = dossier.status;
            statusBadge.className = `status-badge text-lg font-semibold shadow-md ${getDecisionColorClass(dossier.status)}`;
            
            // 2. Reset modules en nav buttons
            document.querySelectorAll('.active-module').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-button-module').forEach(el => el.classList.remove('border-blue-500'));
            document.querySelectorAll('.nav-button-module').forEach(el => el.classList.add('hover:border-blue-500'));


            // 3. Activeer de huidige module en nav button
            const moduleMap = {
                'info': 'module-info',
                'criteria': 'module-criteria',
                'criteria-detail': 'module-criteria-detail',
                'match': 'module-match',
                'match-gis': 'module-match-gis',
                'report': 'module-report',
                'gis-visualisation': 'module-gis-visualisation'
            };

            const moduleToActivate = moduleMap[activeModule] || 'module-info';
            document.getElementById(moduleToActivate).classList.remove('hidden');

            // Nav button highlighting: Criteria detail valt onder de Criteria knop, Match GIS onder Match knop, Report onder Match knop
            let navButtonId = '';
            if (activeModule === 'criteria' || activeModule === 'criteria-detail') {
                 navButtonId = 'nav-criteria';
                 updateK1OverrideDisplay(); // Update K1 status op het Criteria overzicht als we ernaartoe gaan
            } else if (activeModule === 'match' || activeModule === 'match-gis' || activeModule === 'report') {
                 navButtonId = 'nav-match';
            } else {
                 navButtonId = 'nav-info';
            }

            const navButton = document.getElementById(navButtonId);
            if (navButton) {
                navButton.classList.add('border-blue-500');
                navButton.classList.remove('hover:border-blue-500');
            }
            
            // Speciale rendering voor Criteria Detail (moet de data injecteren)
            if (activeModule === 'criteria-detail') {
                 updateCriteriaDetailScreen(currentCriteria);
            }
            
            // Speciale rendering voor GIS Visualisatie (Terugknop)
            if (activeModule === 'gis-visualisation') {
                // De knop 'Toon Kaart' in de header moet nu de terugknop zijn voor deze module
                 document.getElementById('back-from-gis').textContent = `Terug naar ${navButton.querySelector('h3').textContent.replace(' (4a)', '').replace(' (4b)', '')}`;
            }

        }

        function getDecisionColorClass(status) {
            if (status.includes('GO')) return 'status-badge-go';
            if (status.includes('VOORWAARDEN') || status.includes('Check') || status.includes('gesprek')) return 'status-badge-cond';
            if (status.includes('NO GO')) return 'status-badge-nogo';
            return 'status-badge-default';
        }

        function setDetailTab(moduleName) {
             // Sla de huidige module op als 'previous' als we naar een 'dieper' scherm gaan.
            if (moduleName === 'gis-visualisation') {
                previousModule = activeModule;
            }
            activeModule = moduleName;
            renderDetailView();
        }
        
        function goBackFromGis() {
            // Gebruik de opgeslagen vorige module om terug te keren
            activeModule = previousModule;
            renderDetailView();
        }

        // --- Navigation Functions ---

        function goToDetail(id) {
            selectedDossierId = id;
            activeModule = 'info'; // Start altijd op de Dossier Informatie fiche
            previousModule = 'info';
            currentView = VIEWS.DETAIL;
            renderView();
        }

        function goBackToDashboard() {
            selectedDossierId = null;
            currentView = VIEWS.DASHBOARD;
            renderView();
        }

        // --- Criteria Analysis Split Logic ---
        
        // Gaat van Criteria Overzicht naar Criteria Detail/Beslissing
        function goToCriteriaDetail(criteria, destination) {
            currentCriteria = criteria; // Sla het geselecteerde criterium op
            activeModule = 'criteria-detail';
            renderDetailView(); // Render de module-criteria-detail
            
            // Zorg ervoor dat de GIS-kaart de juiste laag toont, tenzij het de Beslissing is
            if (criteria !== 'BESLISSING') {
                showGisMap(criteria);
            }
        }
        
        // Vul de Criteria Detail scherm elementen
        function updateCriteriaDetailScreen(criteria) {
            
            const data = CRITERIA_DATA[criteria] || CRITERIA_DATA['BESLISSING'];
            
            // Bepaal de bestemmingstekst
            const destText = data.dest_huidig || data.dest_nieuw || 'Algemeen Dossier';
            
            document.getElementById('current-criteria-name').textContent = data.name;
            document.getElementById('current-criteria-dest').textContent = destText;
            document.getElementById('current-criteria-context').textContent = data.context || 'N.v.t.';
            
            // Toon of verberg de override sectie en vul het resultaat
            const overrideSection = document.getElementById('override-section');
            const criteriaResult = document.getElementById('current-criteria-result');
            const decisionTitle = document.getElementById('decision-title');
            
            // Toon/Verberg terug knop
            document.querySelector('#module-criteria-detail > button').classList.remove('hidden');

            if (criteria === 'BESLISSING') {
                // Algemeen beslissingsscherm
                overrideSection.classList.add('hidden');
                criteriaResult.textContent = 'Actieve Beslissing';
                criteriaResult.className = 'status-badge status-badge-default';
                decisionTitle.textContent = 'Definitieve Beoordelingsbeslissing';
                document.querySelector('#module-criteria-detail > button').classList.add('hidden'); // Geen terug knop voor de finale beslissing
            } else {
                // Individueel criterium detail
                decisionTitle.textContent = 'Algemene Beoordelingsbeslissing';
                criteriaResult.textContent = data.result;
                criteriaResult.className = `status-badge status-badge-${data.color}`;
                
                // K1 is ons enige NO GO aanpassing voorbeeld
                if (criteria === 'K1') {
                    overrideSection.classList.remove('hidden');
                    updateK1OverrideDisplay();
                    document.getElementById('override-criteria-title').textContent = data.name;
                } else {
                    overrideSection.classList.add('hidden');
                }
            }
            
            // Zorg dat de juiste kaartlaag wordt getoond
            document.getElementById('gis-criteria-layer').textContent = criteria === 'BESLISSING' ? 'Contouren' : criteria;

        }

        // --- K1 Override Logic (Simulatie) ---
        
        function updateK1OverrideDisplay() {
             const k1StatusDisplay = document.getElementById('k1-override-status-display');
             const overviewK1Status = document.getElementById('overview-k1-status');
             const k1CriteriaResult = document.getElementById('current-criteria-result');

             k1StatusDisplay.classList.add('hidden');
             
             if (k1OverrideStatus === 'APPROVED') {
                k1StatusDisplay.classList.remove('hidden');
                k1StatusDisplay.textContent = 'Status: AANGEPAST (GO) - Goedgekeurd door Teamhoofd.';
                document.getElementById('request-approval-btn').disabled = true;
                
                // Update K1 status op het overzicht (Module Criteria)
                if (overviewK1Status) {
                    overviewK1Status.textContent = 'AANGEPAST (GO)';
                    overviewK1Status.classList.remove('status-badge-nogo');
                    overviewK1Status.classList.add('status-badge-go');
                }
                
                // Update K1 status op de detail pagina
                if (k1CriteriaResult) {
                    k1CriteriaResult.textContent = 'AANGEPAAST (GO)';
                    k1CriteriaResult.classList.remove('status-badge-nogo');
                    k1CriteriaResult.classList.add('status-badge-go');
                }

             } else if (k1OverrideStatus === 'PENDING') {
                k1StatusDisplay.classList.remove('hidden');
                k1StatusDisplay.textContent = 'Status: Wacht op fiattering door Teamhoofd...';
                document.getElementById('request-approval-btn').disabled = true;
             }
        }

        function showOverrideModal(criteria) {
            document.getElementById('approval-status').classList.add('hidden');
            document.getElementById('override-motivation').value = '';
            document.getElementById('request-approval-btn').disabled = false;
            document.getElementById('request-approval-btn').classList.remove('opacity-50', 'cursor-not-allowed');
            document.getElementById('override-modal').classList.remove('hidden');
        }

        function hideOverrideModal() {
            document.getElementById('override-modal').classList.add('hidden');
        }

        function requestTeamHeadApproval() {
            const motivation = document.getElementById('override-motivation').value;
            if (motivation.length < 20) {
                console.error("Motivering is te kort. Minimaal 20 tekens vereist.");
                return;
            }
            // Simuleer indiening
            document.getElementById('request-approval-btn').disabled = true;
            document.getElementById('request-approval-btn').classList.add('opacity-50', 'cursor-not-allowed');
            document.getElementById('approval-status').classList.remove('hidden');

            // SIMULATIE: Stel de status in op PENDING
            k1OverrideStatus = 'PENDING'; 
            localStorage.setItem('k1_override_status', 'PENDING');
            updateK1OverrideDisplay();

            // SIMULATIE: Keur na 3 seconden goed
            setTimeout(() => {
                k1OverrideStatus = 'APPROVED';
                localStorage.setItem('k1_override_status', 'APPROVED');
                updateK1OverrideDisplay();
            }, 3000); 

            // Verberg de modal
            hideOverrideModal();
        }

        function setDecision(type) {
            let decisionText;
            switch(type) {
                case 'GO': decisionText = 'GO'; break;
                case 'VOORWAARDEN': decisionText = 'VOORWAARDEN'; break;
                case 'NO GO': decisionText = 'NO GO'; break;
                default: return;
            }

            // Opslaan van de staat (Update dossier status)
            localStorage.setItem('dossier_decision_1', decisionText);
            const dossier = initialDossiers.find(d => d.id === selectedDossierId);
            if (dossier) {
                dossier.status = `Beslist (${decisionText})`;
            }

            // Update UI
            document.getElementById('decision-message').classList.remove('hidden');
            const span = document.getElementById('decision-message').querySelector('span');
            span.textContent = decisionText;
            span.className = `font-extrabold ${getDecisionColorClass(decisionText)}`;

            // Ga automatisch naar de Match module
            setDetailTab('match');
        }

        function showGisMap(criteria) {
            // Update de kaartachtergrond om een laagwisseling te simuleren.
            const layerState = {
                'K5': { color: 'FEF3C7', text: 'D97706' }, 
                'K2': { color: 'FEF3C7', text: 'D97706' }, 
                'K4': { color: 'D1FAE5', text: '059669' }, 
                'K3': { color: 'D1FAE5', text: '059669' }, 
                'K1': { color: 'FEE2E2', text: 'EF4444' }  
            };
            
            const state = layerState[criteria] || { color: 'D1D5DB', text: '4B5563' };
            const mapDiv = document.getElementById('mini-gis-map');
            mapDiv.style.backgroundImage = `url('https://placehold.co/600x400/${state.color}/${state.text}?text=Kaartlaag+Weergave+(${criteria}+actief)')`;

            // Update de kaartlagen checkboxes
            document.querySelectorAll('#mini-gis-map input[type="checkbox"]').forEach(checkbox => {
                 const layerName = checkbox.parentElement.textContent.trim();
                 // Plankcontour staat altijd aan
                 checkbox.checked = layerName.includes('Plankcontour');
                 
                 // Als dit de specifieke laag is die we willen zien, zet deze aan
                 if (layerName.includes(criteria) && criteria !== 'BESLISSING') {
                     checkbox.checked = true;
                 }
            });
        }


        // --- Dashboard Specifics (List/GIS Toggle) ---

        function renderDossierList(gisView = false) {
            const listContainer = document.getElementById('dossier-list-container');
            const gisContainer = document.getElementById('dossier-gis-container');
            const toggleListBtn = document.getElementById('toggle-list');
            const toggleGisBtn = document.getElementById('toggle-gis');
            const listBody = document.getElementById('dossier-list-body');
            listBody.innerHTML = '';

            // Toggle view state classes
            if (gisView) {
                listContainer.classList.add('hidden');
                gisContainer.classList.remove('hidden');
                toggleListBtn.classList.remove('bg-white', 'text-gray-700', 'bg-gray-100', 'text-gray-500'); // Clean slate
                toggleListBtn.classList.add('bg-gray-100', 'text-gray-500'); // Inactief
                toggleGisBtn.classList.remove('bg-gray-100', 'text-gray-500', 'bg-white', 'text-gray-700'); // Clean slate
                toggleGisBtn.classList.add('bg-white', 'text-gray-700'); // Actief
                
                const hoverInfo = document.getElementById('gis-hover-info');
                hoverInfo.classList.remove('hidden');
                
                return;
            } else {
                listContainer.classList.remove('hidden');
                gisContainer.classList.add('hidden');
                toggleListBtn.classList.remove('bg-gray-100', 'text-gray-500', 'bg-white', 'text-gray-700'); // Clean slate
                toggleListBtn.classList.add('bg-white', 'text-gray-700'); // Actief
                toggleGisBtn.classList.remove('bg-white', 'text-gray-700', 'bg-gray-100', 'text-gray-500'); // Clean slate
                toggleGisBtn.classList.add('bg-gray-100', 'text-gray-500'); // Inactief

                document.getElementById('gis-hover-info').classList.add('hidden');
            }

            initialDossiers.forEach(d => {
                const tr = document.createElement('tr');
                tr.className = 'list-row';
                // AANPASSING 1: Maak de hele rij klikbaar
                tr.onclick = () => goToDetail(d.id);
                
                const matchBadge = d.matches > 0 ?
                    `<span class="px-3 py-1 bg-gray-800 text-white text-xs font-semibold rounded-lg shadow-md">${d.matches} matches</span>` :
                    `<span class="text-xs text-gray-400">0 matches</span>`;

                const noteIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400 hover:text-gray-600 transition-colors"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5Z"/></svg>`;

                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${d.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 hidden sm:table-cell">${d.address}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 hidden md:table-cell">${d.opp}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 hidden md:table-cell">${d.type}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 hidden lg:table-cell">${d.update}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="status-badge ${getDecisionColorClass(d.status)}">${d.status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <div class="flex items-center justify-end space-x-2">
                            ${matchBadge}
                            <button class="p-1">${noteIcon}</button>
                            <!-- De detail knop is nu alleen visueel en niet meer functioneel (de rij doet de navigatie) -->
                            <div class="detail-action-button text-gray-500">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                            </div>
                        </div>
                    </td>
                `;
                listBody.appendChild(tr);
            });
        }
        
        // AANPASSING 2: Event Listeners voor de GIS Toggle
        function setupDashboardToggle() {
            document.getElementById('toggle-list').addEventListener('click', () => renderDossierList(false));
            document.getElementById('toggle-gis').addEventListener('click', () => renderDossierList(true));
        }


        // --- Initialization ---

        window.onload = function() {
            setupDashboardToggle(); // Initialiseer de toggle handlers
            renderView();
            // Start de GIS kaart met de K1 laag voor de demo
            showGisMap('K1'); 
        };
    </script>
</body>
</html>
