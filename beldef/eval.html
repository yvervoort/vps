<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Enterprise Project Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    :root { 
      --primary: #2563eb; 
      --success: #059669; 
    }
    
    body { 
      background: #f1f5f9; 
      font-family: 'Inter', sans-serif; 
      color: #1e293b;
    }

    .pipeline-step {
      position: relative;
      flex: 1;
      text-align: center;
      padding-bottom: 1rem;
    }

    .pipeline-step:not(:last-child)::after {
      content: '';
      position: absolute;
      top: 15px;
      left: calc(50% + 15px);
      width: calc(100% - 30px);
      height: 2px;
      background: #e2e8f0;
      z-index: 1;
    }

    .pipeline-step.completed:not(:last-child)::after {
      background: var(--success);
    }

    .step-node {
      position: relative;
      z-index: 2;
      width: 32px;
      height: 32px;
      margin: 0 auto 8px;
      border-radius: 50%;
      background: white;
      border: 2px solid #cbd5e1;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      font-size: 12px;
      font-weight: 600;
    }

    .pipeline-step.completed .step-node {
      background: var(--success);
      border-color: var(--success);
      color: white;
    }

    .pipeline-step.active .step-node {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
      box-shadow: 0 0 0 4px #dbeafe;
    }

    .pipeline-step.pending-selection .step-node {
      border-color: var(--primary);
      color: var(--primary);
      background: #eff6ff;
    }

    .custom-shadow {
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>

<body class="p-6">
  <div class="max-w-6xl mx-auto">
    
    <!-- Top Bar -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8">
      <div>
        <h1 class="text-xl font-bold tracking-tight text-slate-900 flex items-center gap-2">
          <i class="fa-solid fa-layer-group text-blue-600"></i>
          Project Lifecycle Engine
        </h1>
        <p class="text-slate-500 text-xs">Internal Governance & Status Reporting</p>
      </div>

      <div class="flex items-center gap-3 bg-white p-2 rounded-lg border border-slate-200 shadow-sm">
        <i class="fa-solid fa-folder-open text-slate-400 ml-2"></i>
        <select id="projectSelector" class="bg-transparent text-sm font-medium focus:outline-none pr-4 cursor-pointer">
          <!-- Populated by JS -->
        </select>
      </div>
    </div>

    <!-- Progress Pipeline (Enterprise UI) -->
    <div class="bg-white rounded-xl p-8 border border-slate-200 custom-shadow mb-6 overflow-x-auto">
      <div id="pipelineContainer" class="flex min-w-[800px]">
        <!-- Steps generated here -->
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Main Update Area -->
      <div class="lg:col-span-2 space-y-6">
        
        <!-- Context Card -->
        <div class="bg-white rounded-xl border border-slate-200 custom-shadow p-6">
          <div class="flex justify-between items-start border-b border-slate-100 pb-4 mb-6">
            <div>
              <span id="projIdLabel" class="text-[10px] font-bold text-blue-600 uppercase tracking-widest">---</span>
              <h2 id="projNameLabel" class="text-lg font-bold text-slate-800 italic">Select a project...</h2>
              <div class="flex gap-4 mt-1">
                <span class="text-[11px] text-slate-500 flex items-center gap-1">
                  <i class="fa-solid fa-receipt opacity-50"></i> <span id="poLabel">---</span>
                </span>
                <span class="text-[11px] text-slate-500 flex items-center gap-1">
                  <i class="fa-solid fa-clock opacity-50"></i> <span id="lastUpdatedLabel">---</span>
                </span>
              </div>
            </div>
            <div id="statusBadge" class="bg-slate-100 text-slate-600 text-[10px] font-bold px-2.5 py-1 rounded-md uppercase">
              Standby
            </div>
          </div>

          <!-- Evaluation Specific Form (Status F) -->
          <div id="evaluationSection" class="hidden animate-in fade-in slide-in-from-top-2 duration-300">
            <div class="bg-amber-50/50 border border-amber-100 rounded-lg p-5 mb-6">
              <div class="flex items-center gap-2 mb-4 text-amber-800">
                <i class="fa-solid fa-clipboard-check"></i>
                <h3 class="text-sm font-bold uppercase tracking-tight">Phase Gate: Testing & Evaluation</h3>
              </div>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div class="space-y-1">
                  <label class="text-[11px] font-bold text-slate-500 uppercase">Briefing of Actions</label>
                  <textarea id="evalBriefing" class="w-full text-sm border-slate-200 rounded-md focus:ring-blue-500 p-2 h-20" placeholder="Summary of testing activity..."></textarea>
                </div>
                <div class="space-y-1">
                  <label class="text-[11px] font-bold text-slate-500 uppercase">Key Observations</label>
                  <textarea id="evalObservations" class="w-full text-sm border-slate-200 rounded-md focus:ring-blue-500 p-2 h-20" placeholder="Major findings during evaluation..."></textarea>
                </div>
                <div class="space-y-1">
                  <label class="text-[11px] font-bold text-slate-500 uppercase">Impact Assessment</label>
                  <input id="evalImpact" type="text" class="w-full text-sm border-slate-200 rounded-md focus:ring-blue-500 p-2" placeholder="Scale of impact detected...">
                </div>
                <div class="grid grid-cols-2 gap-3">
                  <div class="space-y-1">
                    <label class="text-[11px] font-bold text-slate-500 uppercase">Verdict</label>
                    <select id="evalVerdict" class="w-full text-sm border-slate-200 rounded-md p-2 bg-white">
                      <option>Pass</option>
                      <option>Fail</option>
                      <option>Conditional</option>
                    </select>
                  </div>
                  <div class="space-y-1">
                    <label class="text-[11px] font-bold text-slate-500 uppercase">Intent to Scale?</label>
                    <div class="flex gap-4 mt-2">
                      <label class="flex items-center gap-1.5 text-xs text-slate-700 cursor-pointer">
                        <input type="radio" name="scale" value="Yes" class="w-3.5 h-3.5 text-blue-600"> Yes
                      </label>
                      <label class="flex items-center gap-1.5 text-xs text-slate-700 cursor-pointer">
                        <input type="radio" name="scale" value="No" class="w-3.5 h-3.5 text-blue-600"> No
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- General Status Note -->
          <div class="space-y-1">
            <label class="text-[11px] font-bold text-slate-500 uppercase">Update Comments</label>
            <input id="statusComment" type="text" class="w-full text-sm border-slate-200 rounded-md focus:ring-blue-500 p-2" placeholder="Optional context for this status change...">
          </div>

          <!-- Action Button -->
          <div class="mt-8">
            <button id="saveBtn" class="w-full bg-slate-900 hover:bg-black text-white text-sm font-semibold py-3.5 px-4 rounded-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50">
              <i class="fa-solid fa-cloud-arrow-up text-xs"></i>
              Confirm & Update Project Status
            </button>
            <p class="text-center text-[10px] text-slate-400 mt-3 italic">Updating will append a new record to the audit trail.</p>
          </div>
        </div>
      </div>

      <!-- Right Column: Mini Audit Trail -->
      <div class="space-y-6">
        <div class="bg-white rounded-xl border border-slate-200 custom-shadow p-6 flex flex-col h-full">
          <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center justify-between">
            Recent Activity
            <i class="fa-solid fa-clock-rotate-left"></i>
          </h3>
          <div id="historyLog" class="space-y-4 max-h-[500px] overflow-y-auto pr-2 custom-scroll">
            <!-- Populated by JS -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="fixed top-6 left-1/2 -translate-x-1/2 bg-slate-800 text-white px-5 py-2.5 rounded-full shadow-2xl translate-y-[-100px] opacity-0 transition-all duration-500 flex items-center gap-3 z-50 text-sm">
    <i class="fa-solid fa-circle-check text-emerald-400"></i>
    <span id="toastMsg">Success</span>
  </div>

  <script>
    const STATUS_MAP = [
      { id: 'a', name: 'Offer', detail: 'Proposal/Quotation' },
      { id: 'b', name: 'Budget', detail: 'Allocation & Approval' },
      { id: 'c', name: 'Kick-Off', detail: 'Project Initiation' },
      { id: 'd', name: 'Ordered', detail: 'PO Issued' },
      { id: 'e', name: 'Purchased', detail: 'Procurement Complete' },
      { id: 'f', name: 'Evaluating', detail: 'Outcome Assessment' },
      { id: 'g', name: 'Reporting', detail: 'Documentation' },
      { id: 'h', name: 'Closed', detail: 'Archived' }
    ];

    let mockDatabase = {
      "P-24-101": {
        name: "Enterprise ERP Expansion",
        po: "PO-88210",
        history: [
          { status: 'a', date: '2023-11-01', user: 'Admin', comment: 'Initial quote' },
          { status: 'b', date: '2023-11-15', user: 'Finance', comment: 'Budget approved for FY24' }
        ]
      },
      "P-24-205": {
        name: "Edge Computing Pilot",
        po: "PO-99001; PO-99002",
        history: [
          { status: 'a', date: '2023-10-05', user: 'Systems', comment: 'Initial tender' },
          { status: 'd', date: '2023-10-20', user: 'Ops', comment: 'Hardware ordered' },
          { status: 'f', date: '2023-12-01', user: 'QA', comment: 'Site testing underway', 
            test: { briefing: 'Site A installation complete', observations: 'Stable performance', impact: 'High Efficiency', verdict: 'Pass', scale: 'Yes' } 
          }
        ]
      }
    };

    let activeProject = "";
    let targetStatus = "";

    function init() {
      const selector = document.getElementById('projectSelector');
      Object.keys(mockDatabase).forEach(id => {
        const opt = document.createElement('option');
        opt.value = id;
        opt.textContent = `${id} | ${mockDatabase[id].name}`;
        selector.appendChild(opt);
      });

      activeProject = selector.value;
      loadProject(activeProject);

      selector.onchange = (e) => {
        activeProject = e.target.value;
        loadProject(activeProject);
      };

      document.getElementById('saveBtn').onclick = handleSave;
    }

    function loadProject(id) {
      const proj = mockDatabase[id];
      const latest = proj.history[proj.history.length - 1];
      targetStatus = latest.status;

      // Update Labels
      document.getElementById('projIdLabel').textContent = id;
      document.getElementById('projNameLabel').textContent = proj.name;
      document.getElementById('poLabel').textContent = proj.po;
      document.getElementById('lastUpdatedLabel').textContent = `Last active: ${latest.date}`;
      document.getElementById('statusBadge').textContent = STATUS_MAP.find(s => s.id === latest.status).name;

      renderPipeline(latest.status);
      renderHistory(proj.history);
      toggleEvalFields(latest.status, latest.test);
    }

    function renderPipeline(currentStatusId) {
      const container = document.getElementById('pipelineContainer');
      container.innerHTML = "";
      
      const currentIdx = STATUS_MAP.findIndex(s => s.id === currentStatusId);
      const targetIdx = STATUS_MAP.findIndex(s => s.id === targetStatus);

      STATUS_MAP.forEach((s, idx) => {
        const div = document.createElement('div');
        const isCompleted = idx < currentIdx;
        const isActive = idx === currentIdx;
        const isSelected = idx === targetIdx;

        div.className = `pipeline-step ${isCompleted ? 'completed' : ''} ${isActive ? 'active' : ''} ${isSelected && !isActive ? 'pending-selection' : ''}`;
        
        div.innerHTML = `
          <div class="step-node cursor-pointer">
            ${isCompleted ? '<i class="fa-solid fa-check"></i>' : s.id.toUpperCase()}
          </div>
          <div class="text-[10px] font-bold text-slate-700 mt-1 uppercase tracking-tighter">${s.name}</div>
          <div class="text-[9px] text-slate-400 hidden md:block leading-tight">${s.detail}</div>
        `;

        div.onclick = () => {
          targetStatus = s.id;
          renderPipeline(currentStatusId);
          toggleEvalFields(s.id);
        };

        container.appendChild(div);
      });
    }

    function toggleEvalFields(statusId, existingData = null) {
      const panel = document.getElementById('evaluationSection');
      if (statusId === 'f') {
        panel.classList.remove('hidden');
        if (existingData) {
          document.getElementById('evalBriefing').value = existingData.briefing;
          document.getElementById('evalObservations').value = existingData.observations;
          document.getElementById('evalImpact').value = existingData.impact;
          document.getElementById('evalVerdict').value = existingData.verdict;
          const radio = document.querySelector(`input[name="scale"][value="${existingData.scale}"]`);
          if (radio) radio.checked = true;
        } else {
          // Reset for new entry
          document.querySelectorAll('#evaluationSection input:not([type="radio"]), #evaluationSection textarea').forEach(el => el.value = "");
        }
      } else {
        panel.classList.add('hidden');
      }
    }

    function renderHistory(history) {
      const log = document.getElementById('historyLog');
      log.innerHTML = "";
      
      [...history].reverse().forEach(entry => {
        const sName = STATUS_MAP.find(s => s.id === entry.status).name;
        const div = document.createElement('div');
        div.className = "relative pl-4 border-l-2 border-slate-100 pb-2";
        div.innerHTML = `
          <div class="absolute -left-[7px] top-0 w-3 h-3 rounded-full bg-slate-200 border-2 border-white"></div>
          <div class="text-[10px] text-slate-400 font-mono">${entry.date}</div>
          <div class="text-xs font-bold text-slate-700">${sName}</div>
          <div class="text-[10px] text-slate-500 italic truncate">${entry.comment || 'Updated status'}</div>
          ${entry.test ? `<div class="mt-1 text-[9px] bg-amber-50 text-amber-700 px-1.5 py-0.5 rounded inline-block">Test Record Attached</div>` : ''}
        `;
        log.appendChild(div);
      });
    }

    function handleSave() {
      const proj = mockDatabase[activeProject];
      const today = new Date().toISOString().split('T')[0];
      const comment = document.getElementById('statusComment').value;

      const record = {
        status: targetStatus,
        date: today,
        user: 'Current User',
        comment: comment || `Transitioned to ${targetStatus}`
      };

      if (targetStatus === 'f') {
        record.test = {
          briefing: document.getElementById('evalBriefing').value,
          observations: document.getElementById('evalObservations').value,
          impact: document.getElementById('evalImpact').value,
          verdict: document.getElementById('evalVerdict').value,
          scale: document.querySelector('input[name="scale"]:checked')?.value || 'No'
        };
      }

      proj.history.push(record);
      loadProject(activeProject);
      showToast(`Status updated to ${STATUS_MAP.find(s => s.id === targetStatus).name}`);
      document.getElementById('statusComment').value = "";
    }

    function showToast(msg) {
      const t = document.getElementById('toast');
      document.getElementById('toastMsg').textContent = msg;
      t.classList.remove('translate-y-[-100px]', 'opacity-0');
      t.classList.add('translate-y-0', 'opacity-100');
      setTimeout(() => {
        t.classList.add('translate-y-[-100px]', 'opacity-0');
        t.classList.remove('translate-y-0', 'opacity-100');
      }, 3000);
    }

    window.onload = init;
  </script>
</body>
</html>
